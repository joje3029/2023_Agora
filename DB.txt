-- ERD 클라우드에서 미리보기로 만든거 수정해야함.
-- DB 만드는거 ERD가 안해줘서 내가 만듦.
DROP DATABASE IF EXISTS Agora;
CREATE DATABASE Agora;
USE Agora;

-- 이아는 컬럼명을 걍 다 백틱하는구만. 신경쓰지 말것.

CREATE TABLE `USER_INFO` (
	`id` INT UNSIGNED NOT NULL PRIMARY KEY AUTO_INCREMENT COMMENT '회원ID',
	`uwerId` VARCHAR(20) NOT NULL COMMENT '아이디',
	`passwd` VARCHAR(200) NOT NULL COMMENT '비밀번호',
	`name` VARCHAR(10) NOT NULL COMMENT '이름',
	`nickname` VARCHAR(15) NOT NULL COMMENT '닉네임',
	`email` VARCHAR(50) NOT NULL COMMENT '이메일',
	`telno` VARCHAR(11) NOT NULL COMMENT '전화번호',
	`adres` VARCHAR(50) NOT NULL COMMENT '주소',
	`secsnEnnc` TINYINT UNSIGNED NOT NULL DEFAULT 0 COMMENT '탈퇴유/무 : 유-1 무-0',
	`joinDate` DATETIME NOT NULL COMMENT '가입일',
	`mberAuthor` TINYINT UNSIGNED NOT NULL DEFAULT 1 COMMENT '회원권한: 관리자-2, 일반회원 1',
	`secsnReqstdt` DATETIME NULL COMMENT '탈퇴신청날짜'
);


CREATE TABLE `COLUMN` (
	`Id`	INT UNSIGNED NOT NULL PRIMARY KEY AUTO_INCREMENT	COMMENT '칼럼ID',
	`title`	VARCHAR(50)	NOT NULL	COMMENT '제목',
	`writngTime`	DATETIME	NOT NULL	COMMENT '작성시간',
	`body`	TEXT	NOT NULL	COMMENT '내용',
	`colmnClSetup`	INT	UNSIGNED	NOT NULL	COMMENT '칼럼분류설정(한국 도서 십진 분류법에 따라 구분) 철학-1 종교-2 사회과학-3 자연과학-4 기술과학-5 예술-6 언어-7 문학-8 역사-9',
	`colmnDeleteTime`	DATETIME	NULL	COMMENT '칼럼삭제시간',
	`colmnDeleteEnnc`	TINYINT	UNSIGNED	NOT NULL DEFAULT 0	COMMENT '칼럼삭제유무 : 유(삭제함)-1 무(삭제안함)-0',
	`colmnWrter`	INT	UNSIGNED	NOT NULL	COMMENT '작성자'
);

CREATE TABLE `COLUMN_LIKE` (
	`id` INT UNSIGNED NOT NULL COMMENT '칼럼ID',
	`userUniqId` INT UNSIGNED NOT NULL COMMENT '회원ID'
);

CREATE TABLE `DSCSN_ROOM` (
	`id`	INT UNSIGNED NOT NULL PRIMARY KEY AUTO_INCREMENT	COMMENT '토론방ID',
	`dscsnRoomNm`	VARCHAR(50)	NOT NULL	COMMENT '토론방이름',
	`crtrId`	INT	UNSIGNED NOT NULL	COMMENT '생성자ID',
	`dscsnRoomCreatDete`	DATETIME	NOT NULL	COMMENT '토론방생성일자',
	`dscsnRoomDeleteDete`	DATETIME	NOT NULL	COMMENT '토론방삭제일자'
);

CREATE TABLE `ANSWER` (
	`id`	INT UNSIGNED NOT NULL PRIMARY KEY AUTO_INCREMENT	COMMENT '댓글ID',
	`answerWritingTime`	DATETIME	NOT NULL	COMMENT '댓글작성시간',
	`answerBody`	TEXT	NOT NULL	COMMENT '댓글내용',
	`answerUpdtTime`	DATETIME	NOT NULL	COMMENT '댓글수정된시간',
	`answerDeleteTime`	DATETIME	NOT NULL	COMMENT '댓글삭제시간',
	`answerDeleteEnnc`	INT UNSIGNED	NOT NULL DEFAULT 0	COMMENT '댓글삭제유/무 : 유(삭제함)-1 무(삭제안함)-0'
);

CREATE TABLE `CSTMR_CNSLT_CNTER` (
	`id`	INT UNSIGNED NOT NULL PRIMARY KEY AUTO_INCREMENT	COMMENT '고객상담ID',
	`userUniqId`	INT	UNSIGNED NOT NULL	COMMENT '회원ID',
	`cstmrTitle`	VARCHAR(50)	NOT NULL	COMMENT '제목',
	`cstmrBody`	TEXT	NOT NULL	COMMENT '내용',
	`cstmrAtchmnflDd`	INT	 NULL	COMMENT '첨부파일ID',
	`ricfldSndngYn`	TINYINT	UNSIGNED NOT NULL DEFAULT 0	COMMENT '답보냄여부 : 보냄-1 안보냄-0'
);

CREATE TABLE `UFSD_ATCH_FILE_MNG` (
	`id`	INT UNSIGNED NOT NULL PRIMARY KEY AUTO_INCREMENT	COMMENT '첨부파일ID',
	`atachFileDc`	TEXT	NULL	COMMENT '첨부파일설명',
	`frstRegId`	INT UNSIGNED	NULL	COMMENT '최초등록자ID',
	`frstRegDate`	DATETIME	NULL	COMMENT '최초등록일자'
);

CREATE TABLE `DSCSN_CHTT_DTLS` (
	`id`	INT UNSIGNED NOT NULL PRIMARY KEY AUTO_INCREMENT	COMMENT '대화순서',
	`chatBody`	VARCHAR(10)	NOT NULL	COMMENT '내용',
	`writeDate`	VARCHAR(30)	NOT NULL	COMMENT '작성일자'
);

CREATE TABLE `EMPLYR_SBSCRB` (
	`ownerUserId`	INT	UNSIGNED NOT NULL	COMMENT '회원ID',
	`guestUserId`	INT	UNSIGNED NOT NULL	COMMENT '회원ID'
);

CREATE TABLE `UFSD_ATCH_FILE_INFO` (
	`atchFileSeq`	INT UNSIGNED NOT NULL PRIMARY KEY AUTO_INCREMENT	COMMENT '첨부파일순서',
	`atchFileId`	INT NOT NULL	COMMENT '첨부파일ID',
	`fileName`	VARCHAR(200)	NOT NULL	COMMENT '파일명',
	`fileSaveName`	VARCHAR(100)	NOT NULL	COMMENT '파일저장명',
	`filePath`	VARCHAR(500)	NULL	COMMENT '파일경로',
	`fileExt`	VARCHAR(10)	NOT NULL	COMMENT '파일확장자',
	`fileSize`	VARCHAR(20)	NULL	COMMENT '파일크기',
	`fileEditorYn`	CHAR(1)	NULL	COMMENT '파일에디터사용여부',
	`fileVodYn`	CHAR(1)	NULL	COMMENT '영상파일여부',
	`frstRegId`	INT	NULL	COMMENT '최초등록자ID',
	`frstRegDate`	DATETIME	NULL	COMMENT '최초등록일자'
);

CREATE TABLE `REPLY` (
	`replyUniquId`	INT UNSIGNED NOT NULL PRIMARY KEY AUTO_INCREMENT	COMMENT '대댓글ID',
	`answerUniqId`	INT	UNSIGNED NOT NULL	COMMENT '댓글ID',
	`replyWritingTime`	DATETIME	NOT NULL	COMMENT '댓글작성시간',
	`replyBody`	TEXT	NOT NULL	COMMENT '댓글내용',
	`replyUpdtTime`	DATETIME	NOT NULL	COMMENT '댓글수정된시간',
	`replyDeleteTime`	DATETIME	NOT NULL	COMMENT '댓글삭제시간',
	`replyDeleteEnnc`	TINYINT	NOT NULL	COMMENT '삭제여부 : 유(삭제함)-1 무(삭제안함)-0',
	`replyWrter`	INT UNSIGNED	NOT NULL	COMMENT '작성자'
);

CREATE TABLE `MNGR_ANSWER_HIST` (
	`id`	INT UNSIGNED NOT NULL PRIMARY KEY AUTO_INCREMENT	COMMENT '답변이력ID',
	`cstmrUniqId`	INT UNSIGNED	NOT NULL	COMMENT '고객상담ID',
	`mngrTitle`	VARCHAR(50)	NOT NULL	COMMENT '제목',
	`mngrBody`	TEXT	NOT NULL	COMMENT '내용',
	`mngrAtchmnflId`	INT	UNSIGNED NULL	COMMENT '첨부파일ID'
);

SELECT * FROM `USER_INFO`; # 사용자 정보(member)
SELECT * FROM `COLUMN`; # 칼럼
SELECT * FROM COLUMN_LIKE; # 칼럼 좋아요
SELECT * FROM DSCSN_ROOM; # 토론방
SELECT * FROM ANSWER; # 댓글
SELECT * FROM CSTMR_CNSLT_CNTER; # 고객상담센터
SELECT * FROM UFSD_ATCH_FILE_MNG; # 첨부파일통합관리
SELECT * FROM DSCSN_CHTT_DTLS; # 토론방 채팅내역
SELECT * FROM EMPLYR_SBSCRB; # 사용자 구독
SELECT * FROM UFSD_ATCH_FILE_INFO; # 첨부파일 상세정보
SELECT * FROM REPLY; # 대댓글
SELECT * FROM MNGR_ANSWER_HIST; #관리자답변이력


#관리자 생성
INSERT INTO `USER_INFO` (
  `uwerId`,
  `passwd`,
  `name`,
  `nickname`,
  `email`,
  `telno`,
  `adres`,
  `secsnEnnc`,
  `joinDate`,
  `mberAuthor`,
  `secsnReqstdt`
) VALUES (
  'admin',
  SHA('Admin123456789!'),
  '관리자',
  '관리자씨',
  'phandom0311@naver.com',
  '01012345678',
  '서울특별시 강남구 신사동 123-456',
  0,
  NOW(),
  2,
  NULL
);

#유저 3명 만들기
#일반 유저 1
INSERT INTO `USER_INFO` (
  `uwerId`,
  `passwd`,
  `name`,
  `nickname`,
  `email`,
  `telno`,
  `adres`,
  `secsnEnnc`,
  `joinDate`,
  `mberAuthor`,
  `secsnReqstdt`
) VALUES (
  'test1',
  SHA('Test1123456789!'),
  '뱁새씨',
  '뱁새씨',
  'phandom0311@naver.com',
  '01023456789',
  '서울특별시 강남구 신사동 123-456',
  0,
  NOW(),
  1,
  NULL
);

#일반 유저 2
INSERT INTO `USER_INFO` (
  `uwerId`,
  `passwd`,
  `name`,
  `nickname`,
  `email`,
  `telno`,
  `adres`,
  `secsnEnnc`,
  `joinDate`,
  `mberAuthor`,
  `secsnReqstdt`
) VALUES (
  'test2',
  SHA('Test2123456789!'),
  '뱁새공주님',
  '뱁새공주님',
  'phandom0311@naver.com',
  '01023456789',
  '서울특별시 강남구 신사동 123-456',
  0,
  NOW(),
  1,
  NULL
);

#일반 유저 3
INSERT INTO `USER_INFO` (
  `uwerId`,
  `passwd`,
  `name`,
  `nickname`,
  `email`,
  `telno`,
  `adres`,
  `secsnEnnc`,
  `joinDate`,
  `mberAuthor`,
  `secsnReqstdt`
) VALUES (
  'test3',
  SHA('Test3123456789!'),
  '뱁새아가씨',
  '뱁새아가씨',
  'phandom0311@naver.com',
  '01023456789',
  '서울특별시 강남구 신사동 123-456',
  0,
  NOW(),
  1,
  NULL
);

SELECT * FROM `USER_INFO`;

# 칼럼 랜덤 만들기
INSERT INTO `COLUMN`(
  `title`,
  `writngTime`,
  `body`,
  `colmnClSetup`,
  `colmnDeleteTime`,
  `colmnDeleteEnnc`,
  `colmnWrter`
) VALUES (
  CONCAT('제목_', FLOOR(RAND() * 10000)),
  NOW(),
  CONCAT('내용_', FLOOR(RAND() * 10000)),
  FLOOR(RAND() * 9) + 1,
  NULL,
  0,
  FLOOR(RAND() * 4) + 1
);

/* 칼럼 배로 불리기
INSERT INTO `COLUMN` (
  `title`,
  `writngTime`,
  `body`,
  `colmnClSetup`,
  `colmnDeleteTime`,
  `colmnDeleteEnnc`,
  `colmnWrter`
)
SELECT
  CONCAT('제목_', FLOOR(RAND() * 10000)),
  NOW(),
  CONCAT('내용_', FLOOR(RAND() * 10000)),
  FLOOR(RAND() * 9) + 1,
  NULL,
  0,
  FLOOR(RAND() * 4) + 1
FROM
  `COLUMN`
LIMIT 10; 
-- 원하는 행 수를 지정해주세요
*/

SELECT * FROM `COLUMN`;
SELECT * FROM `USER_INFO`;
/* 테이블 종류
`USER_INFO`  : 사용자정보
`COLUMN`  : 칼럼
`COLUMN_LIKE`  : 칼럼 좋아요
`DSCSN_ROOM`  : 토론방
`ANSWER`  : 댓글
`CSTMR_CNSLT_CNTER`  : 고객상담센터
`UFSD_ATCH_FILE_MNG`  : 첨부파일통합관리
`DSCSN_CHTT_DTLS`  : 토론방 채팅내역
`EMPLYR_SBSCRB`  : 사용자구독
`UFSD_ATCH_FILE_INFO`  : 첨부파일 상세정보
`REPLY`  : 대댓글
`MNGR_ANSWER_HIST`  : 관리자답변이력
*/

#이걸로 가꼬 오려는거
SELECT C.*, U.nickname
FROM `COLUMN` AS C
INNER JOIN `USER_INFO` AS U
ON C.colmnWrter = U.id
WHERE U.id = #{id}